<TEST  nome="Example999">
    <!--DB-CONNECTIONS>
        <CONNECTION name="SGATE-CONNECTION199" driver="oracle.jdbc.driver.OracleDriver"
            db-url="jdbc:oracle:thin:@172.18.13.199:1521:SVILSGATE"
            username="sgate_1" password="sgate_1"/>
        <CONNECTION name="SGATE-CONNECTION82" driver="oracle.jdbc.driver.OracleDriver"
            db-url="jdbc:oracle:thin:@172.18.13.82:1521:XE"
            username="sgate_tugurio" password="sgate_tugurio"/>
    </DB-CONNECTIONS>
    <SET-VARIABLE>
        <SET connection="SGATE-CONNECTION199" name="codice_pod" query="SELECT NUM_POD FROM DOMANDA_AGEV WHERE ID='45111'" type="DB_TYPE" />
    </SET-VARIABLE>
    <EXECUTE-QUERY nome="CambioStatoDomanda">
        <QUERY connection="SGATE-CONNECTION199" name="CambioDataAgevolazione" query="UPDATE DOMANDA_AGEV SET STATO_DOMANDA='ammessa' WHERE ID=45111" type="UPDATE"/>
    </EXECUTE-QUERY>
    <DATASETS_DBUNIT connection="SGATE-CONNECTION199" nome="CessazioneLatoComune008PresaInCaricoCessazioneViaWebServiceSelenium verifica stato dopo presa in carico segnalazione">
        <dataset>
            <RICHIESTA_VARIAZ ID_DOMANDA_AGEV="45111" STATO_RICHIESTA="disponibile"/>
        </dataset>
    </DATASETS_DBUNIT>
    <RUN-PLUGIN class="org.xmlblackbox.test.infrastructure.functions.GenerateDate" >
            <PARAMETERS>
    			<PARAMETER name="pattern" value="yyyyMMdd" />
                <PARAMETER name="addOrSubDays" value="-30"/>
            </PARAMETERS>
    </RUN-PLUGIN-->
    <SET-VARIABLE>
        <SET name="codice_pod" value='codicePOD'" type="VALUE_TYPE" />
    </SET-VARIABLE>
    <XML-CONTENT
            fileinput="src/test/resources/templateXml/WebServiceTemplate/Example999.xml"
            fileoutput="target/Example999_1_out.xml"
            namespace="declare namespace xsd='http://www.example.xmlblackbox.org/xsd/';">
	        <XML-INSERT-ROW NAME="insertMittente"
                    xpath="$this//xsd:spedizione/xsd:mittente/xsd:codiceMittente"
                    value="${codice_pod@setVariable}"/>
	        <XML-INSERT-ROW NAME="insertLogin"
                    xpath="$this//xsd:spedizione/xsd:mittente/xsd:login"
                    value="${USERNAME@fileProperties}"/>
	        <XML-INSERT-ROW NAME="insertPassword"
                    xpath="$this//xsd:spedizione/xsd:mittente/xsd:password"
                    value="gdgd!6yhfy"/>
	</XML-CONTENT>
<!--
    <RUN-PLUGIN class="org.xmlblackbox.test.functions.xmlblackbox.PresaInCaricoSvuotaCodeXBB" >
            <PARAMETERS>
    			<PARAMETER name="SGATE_WEB_SERVICE_URL" value="${SGATE_WEB_SERVICE_URL@fileProperties}" />
                <PARAMETER name="username" value="${USERNAME_DISTRIBUTORE@fileProperties}"/>
                <PARAMETER name="password" value="${PASSWORD_DISTRIBUTORE@fileProperties}"/>
                <PARAMETER name="codice_distributore" value="${CODICE_DISTRIBUTORE@fileProperties}"/>
            </PARAMETERS>
    </RUN-PLUGIN>
    <RUN-PLUGIN class="org.xmlblackbox.test.functions.xmlblackbox.GeneraIseeXBB" />
    <RUN-PLUGIN class="org.xmlblackbox.test.functions.xmlblackbox.GeneraCodiceFiscaleXBB" />
    <RUN-PLUGIN class="org.xmlblackbox.test.functions.xmlblackbox.GeneraProtocolloComuneXBB" />
    <RUN-PLUGIN class="org.xmlblackbox.test.functions.xmlblackbox.GeneraPodXBB">
            <PARAMETERS>
                    <PARAMETER  name="codice_distributore" value="${CODICE_DISTRIBUTORE@fileProperties}" />
            </PARAMETERS>
    </RUN-PLUGIN>
-->
    <XML-CONTENT
            fileinput="src/test/resources/templateXml/WebServiceTemplate/RichiestaPresaInCaricoWebService.xml"
            fileoutput="target/RichiestaPresaInCaricoWebService_1_out.xml"
            namespace="declare namespace xsd='http://www.sgate.ancitel.it/xsd/';">
	        <XML-INSERT-ROW NAME="insertCodiceDistributore"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:mittente/xsd:codiceDistributore"
                    value="${CODICE_DISTRIBUTORE@fileProperties}"/>
	        <XML-INSERT-ROW NAME="insertLogin"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:mittente/xsd:login"
                    value="${USERNAME_DISTRIBUTORE@fileProperties}"/>
	        <XML-INSERT-ROW NAME="insertPassword"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:mittente/xsd:password"
                    value="${PASSWORD_DISTRIBUTORE@fileProperties}"/>
	</XML-CONTENT>
    <SELENIUM nome="EsportaAnagrafica001 Login con SELENIUM">
		<FILE-NAVIGATION>org.xmlblackbox.test.selenium.xmlblackbox.GenericLoginXBB</FILE-NAVIGATION>
		<PARAMETERS>
			<PARAMETER name="SGATE_WEB_URL" value="${SGATE_WEB_URL@fileProperties}" />
			<PARAMETER name="username" value="${USERNAME_COMUNE@fileProperties}"/>
			<PARAMETER name="password" value="${PASSWORD_COMUNE@fileProperties}"/>
		</PARAMETERS>
	</SELENIUM>
    <SELENIUM nome="EsportaAnagrafica001 Crea domanda economica PRESA IN CARICO">
		<TYPE name="WEB_SELENIUM"/>
		<FILE-NAVIGATION>org.xmlblackbox.test.selenium.xmlblackbox.CreaDomandaEconomicaXBB</FILE-NAVIGATION>
		<PARAMETERS>
			<PARAMETER name="click_button_finale" value="_finish_presenta"/>
			<PARAMETER name="potenza_impegnata" value="3"/>
            <PARAMETER name="codice_provincia_comune" value="${CODICE_PROVINCIA_COMUNE@fileProperties}"/>
			<PARAMETER name="codice_comune" value="${CODICE_COMUNE@fileProperties}"/>
			<PARAMETER name="codice_fiscale" value="${codice_fiscale@runFunction}"/>
			<PARAMETER name="cognome" value="${cognome@runFunction}"/>
			<PARAMETER name="nome" value="${nome@runFunction}"/>
			<PARAMETER name="data_nascita_giorno" value="${data_nascita_giorno@runFunction}"/>
			<PARAMETER name="data_nascita_mese" value="${data_nascita_mese@runFunction}"/>
			<PARAMETER name="data_nascita_anno" value="${data_nascita_anno@runFunction}"/>
			<PARAMETER name="codice_pod" value="${codice_pod@runFunction}"/>
			<PARAMETER name="codice_isee" value="${codice_isee@runFunction}"/>
		</PARAMETERS>
	</SELENIUM>
    <DATASETS_DBUNIT nome="Example999 verifica stato della domanda dopo creazione">
		<dataset>
			<DOMANDA_AGEV ID="${idDomanda@webNavigation}" STATO_DOMANDA="ammessa"/>
			<RICHIESTA_VARIAZ ID_DOMANDA_AGEV="${idDomanda@webNavigation}" STATO_RICHIESTA="disponibile"/>
		</dataset>
		<PARAMETERS>
			<PARAMETER name="idDomanda" value="${idDomanda@webNavigation}"/>
		</PARAMETERS>
	</DATASETS_DBUNIT>
    <SELENIUM nome="Example999 Login come impresa con SELENIUM">
		<TYPE name="WEB_SELENIUM"/>
		<FILE-NAVIGATION>org.xmlblackbox.test.selenium.xmlblackbox.GenericLoginXBB</FILE-NAVIGATION>
		<PARAMETERS>
			<PARAMETER name="username" value="${USERNAME_DISTRIBUTORE@fileProperties}"/>
			<PARAMETER name="password" value="${PASSWORD_DISTRIBUTORE@fileProperties}"/>
		</PARAMETERS>
	</SELENIUM>
    <SELENIUM nome="Example999 genera il lotto di richieste con SELENIUM">
		<TYPE name="WEB_SELENIUM"/>
		<FILE-NAVIGATION>org.xmlblackbox.test.selenium.xmlblackbox.GeneraRichiesteXBB</FILE-NAVIGATION>
	</SELENIUM>
    <RUN-PLUGIN class="org.xmlblackbox.test.functions.xmlblackbox.CaricaIdRichiestaSegnalazioneLottoDaIdDomandaXBB" >
        <PARAMETERS>
                <PARAMETER  name="idDomanda" value="${idDomanda@webNavigation}" />
        </PARAMETERS>
    </RUN-PLUGIN>

    <SET-VARIABLE>
        <SET name="idLottoGenerazioneRich" value="${idLotto@runFunction}" type="VALUE_TYPE"/>
        <SET name="idRichiesta" value="${idRichiesta@runFunction}" type="VALUE_TYPE"/>
    </SET-VARIABLE>
    <DATASETS_DBUNIT nome="Example999 verifica stato dopo la generazione del lotto">
		<dataset>
            <RICHIESTA_COMUNICAZIONE CODICE="${idLottoGenerazioneRich@setVariable}" ID_STATO="0" />
            <MOVIMENTI ID_RICHIESTA="${idRichiesta@setVariable}" Id_COMUNIC="${idLottoGenerazioneRich@setVariable}" TIPO_MOV="MOV_RICH"/>
		</dataset>
	</DATASETS_DBUNIT>
    <SELENIUM nome="Example999 Login come comune con SELENIUM">
		<FILE-NAVIGATION>org.xmlblackbox.test.selenium.xmlblackbox.GenericLoginXBB</FILE-NAVIGATION>
        <PARAMETERS>
			<PARAMETER name="username" value="${USERNAME_COMUNE@fileProperties}"/>
			<PARAMETER name="password" value="${PASSWORD_COMUNE@fileProperties}"/>
		</PARAMETERS>
	</SELENIUM>
    <SELENIUM nome="Example999 Cessazione domanda con SELENIUM">
		<FILE-NAVIGATION>org.xmlblackbox.test.selenium.xmlblackbox.CessazioneDomandaConMotivazioniXBB</FILE-NAVIGATION>
         <PARAMETERS>
                <PARAMETER  name="idDomanda" value="${idDomanda@webNavigation}" />
        </PARAMETERS>
	</SELENIUM>
    <DATASETS_DBUNIT nome="Example999 verifica stato della domanda dopo la generazione del lotto">
		<dataset>
			<DOMANDA_AGEV ID="${idDomanda@webNavigation}" STATO_DOMANDA="cessata"/>
			<RICHIESTA_VARIAZ ID_DOMANDA_AGEV="${idDomanda@webNavigation}" STATO_RICHIESTA="disponibile"/>
            <SEGNALAZIONE_SGATE ID_DOMANDA_AGEV="${idDomanda@webNavigation}" STATO_SEGNALAZIONE="disponibile" DTYPE="SC" />
		</dataset>
	</DATASETS_DBUNIT>

    <WEB-SERVICE-CLIENT nome="webservice.richiestaPresaInCarico">
        <FILE_INPUT>target/RichiestaPresaInCaricoWebService_1_out.xml</FILE_INPUT>
        <FILE_OUTPUT>target/Example999_2_out.xml</FILE_OUTPUT>
        <URL>${SGATE_WEB_SERVICE_URL@fileProperties}</URL>
        <STUB>org.xmlblackbox.test.webservice.client.SgateWebServiceStub</STUB>
        <OPERATION>PresaInCaricoLotto</OPERATION>
    </WEB-SERVICE-CLIENT>
    <VALIDATE-XML 
        xml="target/Example999_2_out.xml"
        xsd="${XSD_SGATE@fileProperties}" />

    <SET-VARIABLE>
        <SET name="idLotto" filename="target/Example999_2_out.xml"
            namespace="declare namespace xsd='http://www.sgate.ancitel.it/xsd/';"
            xpath="$this//xsd:rispostaPresaInCaricoLotto/xsd:lottoMessaggi/xsd:idLotto"
            type="XML_TYPE"/>
    </SET-VARIABLE>
    <XML-CONTENT
            fileinput="src/test/resources/templateXml/WebServiceTemplate/RichiestaPresaInCaricoWebServiceConIdUltimoLottoRicevuto.xml"
            fileoutput="target/RichiestaPresaInCaricoWebServiceConLotto_1_out.xml"
            namespace="declare namespace xsd='http://www.sgate.ancitel.it/xsd/';">
	        <XML-INSERT-ROW NAME="insertCodiceDistributore"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:mittente/xsd:codiceDistributore"
                    value="${CODICE_DISTRIBUTORE@fileProperties}"/>
	        <XML-INSERT-ROW NAME="insertLogin"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:mittente/xsd:login"
                    value="${USERNAME_DISTRIBUTORE@fileProperties}"/>
	        <XML-INSERT-ROW NAME="insertPassword"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:mittente/xsd:password"
                    value="${PASSWORD_DISTRIBUTORE@fileProperties}"/>
	        <XML-INSERT-ROW NAME="insertPassword"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:idUltimoLottoRicevutoCorrettamente"
                    value="${idLotto@setVariable}"/>
	</XML-CONTENT>
    <WEB-SERVICE-CLIENT nome="webservice.effettivaPresaInCarico">
        <FILE_INPUT>target/RichiestaPresaInCaricoWebServiceConLotto_1_out.xml</FILE_INPUT>
        <FILE_OUTPUT>target/Example999_3_out.xml</FILE_OUTPUT>
        <URL>${SGATE_WEB_SERVICE_URL@fileProperties}</URL>
        <STUB>org.xmlblackbox.test.webservice.client.SgateWebServiceStub</STUB>
        <OPERATION>PresaInCaricoLotto</OPERATION>
    </WEB-SERVICE-CLIENT>
    <WEB-SERVICE-CLIENT nome="webservice.richiestaPresaInCarico">
        <FILE_INPUT>target/RichiestaPresaInCaricoWebService_1_out.xml</FILE_INPUT>
        <FILE_OUTPUT>target/Example999_4_out.xml</FILE_OUTPUT>
        <URL>${SGATE_WEB_SERVICE_URL@fileProperties}</URL>
        <STUB>org.xmlblackbox.test.webservice.client.SgateWebServiceStub</STUB>
        <OPERATION>PresaInCaricoLotto</OPERATION>
    </WEB-SERVICE-CLIENT>
    <SET-VARIABLE>
        <SET name="idLotto" filename="target/Example999_4_out.xml"
            namespace="declare namespace xsd='http://www.sgate.ancitel.it/xsd/';"
            xpath="$this//xsd:rispostaPresaInCaricoLotto/xsd:lottoMessaggi/xsd:idLotto"
            type="XML_TYPE"/>
    </SET-VARIABLE>
    <XML-CONTENT
            fileinput="src/test/resources/templateXml/WebServiceTemplate/RichiestaPresaInCaricoWebServiceConIdUltimoLottoRicevuto.xml"
            fileoutput="target/RichiestaPresaInCaricoWebServiceSenzaLotto_2_out.xml"
            namespace="declare namespace xsd='http://www.sgate.ancitel.it/xsd/';">
	        <XML-INSERT-ROW NAME="insertCodiceDistributore"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:mittente/xsd:codiceDistributore"
                    value="${CODICE_DISTRIBUTORE@fileProperties}"/>
	        <XML-INSERT-ROW NAME="insertLogin"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:mittente/xsd:login"
                    value="${USERNAME_DISTRIBUTORE@fileProperties}"/>
	        <XML-INSERT-ROW NAME="insertPassword"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:mittente/xsd:password"
                    value="${PASSWORD_DISTRIBUTORE@fileProperties}"/>
	        <XML-INSERT-ROW NAME="insertidUltimoLottoRicevutoCorrettamente"
                    xpath="$this//xsd:richiestaPresaInCaricoLotto/xsd:idUltimoLottoRicevutoCorrettamente"
                    value="${idLotto@setVariable}"/>
	</XML-CONTENT>
    <WEB-SERVICE-CLIENT nome="webservice.presaInCarico">
		<FILE_INPUT>target/RichiestaPresaInCaricoWebServiceSenzaLotto_2_out.xml</FILE_INPUT>
		<FILE_OUTPUT>target/Example999_5_out.xml</FILE_OUTPUT>
		<URL>${SGATE_WEB_SERVICE_URL@fileProperties}</URL>
		<STUB>org.xmlblackbox.test.webservice.client.SgateWebServiceStub</STUB>
		<OPERATION>PresaInCaricoLotto</OPERATION>
	</WEB-SERVICE-CLIENT>
    <DATASETS_DBUNIT nome="CessazioneLatoComune008PresaInCaricoCessazioneViaWebServiceSelenium verifica stato dopo presa in carico segnalazione">
        <dataset>
            <RICHIESTA_VARIAZ ID_DOMANDA_AGEV="${idDomanda@webNavigation}" STATO_RICHIESTA="presaInCarico"/>
            <SEGNALAZIONE_SGATE ID_DOMANDA_AGEV="${idDomanda@webNavigation}" STATO_SEGNALAZIONE="presaInCarico" DTYPE="SC" />
        </dataset>
    </DATASETS_DBUNIT>
    <CHECK-XML-CONTENT name="CHECK-XML-CONTENT"
            fileinput="target/Example999_2_out.xml"
            namespace="declare namespace xsd='http://www.sgate.ancitel.it/xsd/';">
        <XML-CHECK-ROW name="VerificaRispostaPresaInCarico"
            xpath="$this//xsd:rispostaPresaInCaricoLotto/xsd:lottoMessaggi/xsd:listaMessaggi/xsd:messaggio/xsd:protocollo"
            value="${idRichiesta@setVariable}"/>
	</CHECK-XML-CONTENT>
</TEST>

