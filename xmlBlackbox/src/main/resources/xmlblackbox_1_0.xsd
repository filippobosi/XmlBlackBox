<?xml version="1.0" encoding="utf-8" ?>

<xs:schema xmlns:xmlblackbox="http://www.xmlblackbox.org/xsd/" elementFormDefault="qualified" 
targetNamespace="http://www.xmlblackbox.org/xsd/" 
xmlns:xs="http://www.w3.org/2001/XMLSchema">

    
<xs:complexType name="DB-CONNECTION">
	<xs:annotation>
		<xs:documentation>
			Identify a database connection
	</xs:documentation>
	</xs:annotation>
	<xs:sequence>
		<xs:element name="CONNECTION">
			<xs:attribute name="name" type="xs:string" use="required"/>
			<xs:attribute name="driver" type="xs:string" use="required"/>
			<xs:attribute name="db-url" type="xs:string" use="required"/>
			<xs:attribute name="username" type="xs:string" use="required"/>
			<xs:attribute name="password" type="xs:string" use="required"/>
		</xs:element>
	</xs:sequence>
	<xs:attribute name="name" type="xs:string" use="required"/>
</xs:complexType>

<xs:simpleType name="setVariableType">
	<xs:restriction base="xs:string">
		<xs:pattern value="XML_TYPE|VALUE_TYPE|DB_TYPE" />
	</xs:restriction>
</xs:simpleType>

<xs:complexType name="SET-VARIABLE">
	<xs:annotation>
		<xs:documentation>
			Identify a step for setting variable
	</xs:documentation>
	</xs:annotation>
	<xs:sequence>
		<xs:element name="SET">
			<xs:attribute name="connection" type="xs:string" use="required"/>
			<xs:attribute name="name" type="xs:string" use="required"/>
			<xs:attribute name="value" type="xs:string" />
			<xs:attribute name="query" type="xs:string" />
			<xs:attribute name="filename" type="xs:string" />
			<xs:attribute name="namespace" type="xs:string" />
			<xs:attribute name="xpath" type="xs:string" />
			<xs:attribute name="type" type="xs:string" use="xmlblackbox:setVariableType"/>
		</xs:element>
	</xs:sequence>
	<xs:attribute name="name" type="xs:string" use="required"/>
</xs:complexType>

<xs:complexType name="EXECUTE-QUERY">
	<xs:annotation>
		<xs:documentation>
			Identify a step for executing query
	</xs:documentation>
	</xs:annotation>
	<xs:sequence>
		<xs:element name="QUERY">
			<xs:attribute name="connection" type="xs:string" use="required"/>
			<xs:attribute name="name" type="xs:string" use="required"/>
			<xs:attribute name="query" type="xs:string" use="required"/>
			<xs:attribute name="type" type="xs:string" use="required"/>
		</xs:element>
	</xs:sequence>
	<xs:attribute name="name" type="xs:string" use="required"/>
</xs:complexType>

<xs:complexType name="CHECK-DB">
	<xs:annotation>
		<xs:documentation>
			Identify a step for db check
	</xs:documentation>
	</xs:annotation>
	<xs:sequence>
		<xs:element name="dataset">
			<xs:attribute name="connection" type="xs:string" use="required"/>
			<xs:attribute name="name" type="xs:string" use="required"/>
		</xs:element>
	</xs:sequence>
	<xs:attribute name="name" type="xs:string" use="required"/>
	<xs:attribute name="connection" type="xs:string" use="required"/>
</xs:complexType>

<xs:complexType name="RUN-PLUGIN">
	<xs:annotation>
		<xs:documentation>
			Identify a step for run a plugin
	</xs:documentation>
	</xs:annotation>
	<xs:element name="PARAMETERS">
		<xs:attribute name="connection" type="xs:string" use="required"/>
		<xs:attribute name="name" type="xs:string" use="required"/>
	</xs:element>
	<xs:attribute name="name" type="xs:string" use="required"/>
	<xs:attribute name="class" type="xs:string" use="required"/>
</xs:complexType>

<xs:complexType name="PARAMETERS">
	<xs:sequence>
		<xs:element name="PARAMETER">
			<xs:attribute name="name" type="xs:string" use="required"/>
			<xs:attribute name="value" type="xs:string" use="required"/>
		</xs:element>
	</xs:sequence>
	<xs:attribute name="name" type="xs:string" use="required"/>
	<xs:attribute name="class" type="xs:string" use="required"/>
</xs:complexType>


<xs:complexType name="XML-CONTENT">
	<xs:annotation>
		<xs:documentation>
			Identify a step for checking xml file content
	</xs:documentation>
	</xs:annotation>
	<xs:sequence>
		<xs:element name="XML-INSERT-ROW">
			<xs:attribute name="NAME" type="xs:string" use="required"/>
			<xs:attribute name="xpath" type="xs:string" use="required"/>
			<xs:attribute name="value" type="xs:string" use="required"/>
		</xs:element>
		<xs:element name="XML-CHECK-ROW">
			<xs:attribute name="NAME" type="xs:string" use="required"/>
			<xs:attribute name="xpath" type="xs:string" use="required"/>
			<xs:attribute name="value" type="xs:string" use="required"/>
		</xs:element>
	</xs:sequence>
	<xs:attribute name="name" type="xs:string" use="required"/>
	<xs:attribute name="fileinput" type="xs:string" use="required"/>
	<xs:attribute name="fileoutput" type="xs:string" use="required"/>
	<xs:attribute name="namespace" type="xs:string" use="required"/>
</xs:complexType>

<xs:complexType name="WEB-SERVICE-CLIENT">
	<xs:annotation>
		<xs:documentation>
			Identify a step for executing a web service call
		</xs:documentation>
	</xs:annotation>
	<xs:attribute name="name" type="xs:string" use="required"/>
	<xs:element name="FILE-INPUT" type="xs:string">
	<xs:element name="FILE-OUTPUT" type="xs:string">
	<xs:element name="URL" type="xs:string">
	<xs:element name="STUB" type="xs:string">
	<xs:element name="OPERATION" type="xs:string">
</xs:complexType>

<xs:complexType name="SELENIUM">
	<xs:annotation>
		<xs:documentation>
			Identify a step for executing a web navigation
		</xs:documentation>
	</xs:annotation>
	<xs:attribute name="name" type="xs:string" use="required"/>
	<xs:element name="FILE-NAVIGATION" type="xs:string">
	<xs:element name="PARAMETERS" type="xmlblackbox:PARAMETERS">
</xs:complexType>

<xs:complexType name="VALIDATE-XML">
	<xs:annotation>
		<xs:documentation>
			Identify a step for validating an xml file
		</xs:documentation>
	</xs:annotation>
	<xs:attribute name="name" type="xs:string" use="required"/>
	<xs:attribute name="xml" type="xs:string" use="required"/>
	<xs:attribute name="xsd" type="xs:string" use="required"/>
</xs:complexType>

<xs:simpleType name="setVariableType">
	<xs:restriction base="xs:string">
		<xs:pattern value="XML_TYPE|VALUE_TYPE|DB_TYPE" />
	</xs:restriction>
</xs:simpleType>

<!--
<xs:simpleType name="tipoSesso">
	<xs:restriction base="xs:string">
		<xs:length value="1" />
		<xs:pattern value="M|F" />
	</xs:restriction>
</xs:simpleType>
  <xs:simpleType name="tipoCodiceFiscale">
    <xs:restriction base="xs:string">
      <xs:pattern value="([A-Z0-9]){16}|(\d){11}" />
      <xs:maxLength value="16" />
    </xs:restriction>
  </xs:simpleType>
	<xs:simpleType name="tipoCap">
		<xs:restriction base="sgate:tipoNumerico">
			<xs:length value="5" />
		</xs:restriction>
	</xs:simpleType>
	<xs:simpleType name="tipoIstat">
		<xs:restriction base="sgate:tipoNumerico">
			<xs:length value="6" />
		</xs:restriction>
	</xs:simpleType>
	<xs:simpleType name="tipoCharMax80">
		<xs:restriction base="xs:string">
			<xs:minLength value="1" />
			<xs:maxLength value="80" />
		</xs:restriction>
	</xs:simpleType>
	<xs:simpleType name="tipoProtocollo">
		<xs:restriction base="xs:string">
			<xs:minLength value="1" />
			<xs:maxLength value="20" />
			<xs:pattern value="([a-zA-Z0-9])*" />
		</xs:restriction>
	</xs:simpleType>
	<!--
		Il carattere '-' ï¿½ un carattere speciale che indica un range,se non viene 
		preceduto da un carattere di escape '\' l'espressione regolare non funziona 
		in fase di generazione viene generato il seguente errore [WARNING] InvalidRegex: 
		Pattern value '([a-zA-Z0-9-])*' is not a valid regular exression. 
		The reported error
		was: ''-' is an invalid character range. Write '\- '.'.
	-->
	<xs:simpleType name="tipoProtocolloEnte">
		<xs:restriction base="xs:string">
			<xs:pattern value="([a-zA-Z0-9\-])*" />
			<xs:minLength value="1" />
			<xs:maxLength value="35" />
		</xs:restriction>
	</xs:simpleType>
	<xs:simpleType name="tipoPod">
		<xs:restriction base="sgate:tipoAlfaNumerico">
			<xs:maxLength value="15" />
		</xs:restriction>
	</xs:simpleType>
	<xs:simpleType name="tipoNumeroPresa">
		<xs:restriction base="sgate:tipoAlfaNumerico">
			<xs:maxLength value="30" />
		</xs:restriction>
	</xs:simpleType>
	<xs:simpleType name="tipoNumeroCivico">
		<xs:restriction base="xs:string">
			<xs:maxLength value="10" />
		</xs:restriction>
	</xs:simpleType>
	<xs:simpleType name="tipoCodiceAgevolazione">
		<xs:restriction base="xs:string">
			<xs:maxLength value="10" />
			<xs:minLength value="1" />
		</xs:restriction>
	</xs:simpleType>
	<!-- FINE Definizione dei tipi primitivi -->

	<xs:complexType name="tipoErrore">
		<xs:annotation>
			<xs:documentation>
				Identifica una casistica di errore
        	</xs:documentation>
		</xs:annotation>
		<xs:sequence>
			<xs:element name="tipologia">
				<xs:simpleType>
					<xs:restriction base="xs:string">
						<xs:pattern value="TEMPORANEO|PERMANENTE" />
					</xs:restriction>
				</xs:simpleType>
			</xs:element>
			<xs:element name="codice" type="xs:int" />
			<xs:element minOccurs="0" name="dettaglio" type="xs:string" />
		</xs:sequence>
	</xs:complexType>
	<xs:complexType name="tipoRicezioneMessaggio">
		<xs:annotation>
			<xs:documentation>
				Esito della ricezione del messaggio
        	</xs:documentation>
		</xs:annotation>
		<xs:sequence>
			<xs:element name="protocollo" type="sgate:tipoProtocollo" />
			<xs:element name="esito">
				<xs:simpleType>
					<xs:restriction base="xs:string">
						<xs:pattern value="OK|ERR" />
					</xs:restriction>
				</xs:simpleType>
			</xs:element>
			<xs:element minOccurs="0" name="errore" type="sgate:tipoErrore" />
		</xs:sequence>
	</xs:complexType>
	<!-- FINE Definizione dei tipi primitivi -->

  <xs:complexType name="tipoDatiPersonaliPrimari">
    <xs:annotation>
      <xs:documentation>
    		Dati anagrafici del cittadino
    	</xs:documentation>
    </xs:annotation>
    <xs:sequence>
      <xs:element name="protocolloSGATE" type="sgate:tipoProtocollo" />
      <xs:element name="dataPresentazione" type="xs:date" />
      <xs:element name="nome" type="sgate:tipoCharMax80" />
      <xs:element name="cognome" type="sgate:tipoCharMax80" />
      <xs:element name="codiceFiscale" type="sgate:tipoCodiceFiscale" />
      <xs:element name="dataNascita" type="xs:date" />
      <xs:element name="statoNascita" type="xs:string" />
      <xs:element name="istatNascita" nillable="true">
        <xs:simpleType>
          <xs:restriction base="sgate:tipoIstat">
            <xs:length value="6" />
          </xs:restriction>
        </xs:simpleType>
      </xs:element>
      <xs:element name="istatResidenza">
        <xs:simpleType>
          <xs:restriction base="sgate:tipoIstat">
            <xs:length value="6" />
          </xs:restriction>
        </xs:simpleType>
      </xs:element>
      <xs:element name="indirizzoResidenza">
        <xs:simpleType>
          <xs:restriction base="xs:string">
            <xs:maxLength value="120" />
          </xs:restriction>
        </xs:simpleType>
      </xs:element>
      <xs:element name="civicoResidenza" type="sgate:tipoNumeroCivico" />
      <xs:element name="capResidenza">
        <xs:simpleType>
          <xs:restriction base="sgate:tipoCap">
            <xs:length value="5" />
          </xs:restriction>
        </xs:simpleType>
      </xs:element>
      <xs:element name="componentiFamigliaAnagrafica" type="xs:int" maxOccurs="1" minOccurs="0"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="tipoFileAnagraficheComunali">
    <xs:sequence>
      <xs:element maxOccurs="unbounded" name="cittadino" type="sgate:tipoDatiPersonaliPrimari" />
    </xs:sequence>
  </xs:complexType>
  <xs:element name="anagraficheComunali" type="sgate:tipoFileAnagraficheComunali" />
  <xs:complexType name="tipoEsitoAnagraficaComunale">
    <xs:sequence>
    	<xs:element name="protocolloSGATE" type="sgate:tipoProtocollo" />

    	<xs:element name="comuneResidenza"
    		type="sgate:tipoEsitoElementoAnagrafica">
    	</xs:element>
    	<xs:element name="indirizzoResidenza"
    		type="sgate:tipoEsitoElementoAnagrafica">
    	</xs:element>
    	<xs:element name="civicoResidenza"
    		type="sgate:tipoEsitoElementoAnagrafica">
    	</xs:element>
    	<xs:element name="numerositaAnagrafica" type="sgate:tipoEsitoElementoAnagrafica" maxOccurs="1" minOccurs="0"></xs:element>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="tipoFileEsitoAnagraficheComunali">
    <xs:sequence>
      <xs:element name="esitoCittadino" type="sgate:tipoEsitoAnagraficaComunale" maxOccurs="unbounded" minOccurs="1"/>
    </xs:sequence>
  </xs:complexType>
  <xs:element name="esitiAnagraficheComunali" type="sgate:tipoFileEsitoAnagraficheComunali" />

  <xs:complexType name="tipoEsitoElementoAnagrafica">
  	<xs:sequence>
  		<xs:element name="esito" type="xs:boolean"></xs:element>
  		<xs:element name="valoreRiscontrato" type="xs:string" maxOccurs="1" minOccurs="0"></xs:element>
  	</xs:sequence>
  </xs:complexType>
  
  	<!-- ESITI RICEZIONE ANAGRAFICA COMUNALE -->
  <xs:complexType name="tipoFileRicevuteEsitiAnagraficheComunali">
	<xs:annotation>
		<xs:documentation>
			Rappresenta la struttura del file che contiene
			informazioni circa la ricezione degli esiti delle
			anagrafiche inviate dal comune
       	</xs:documentation>
	</xs:annotation>
	<xs:sequence>
		<xs:element maxOccurs="unbounded" name="ricevutaEsitoAnagrafica" type="sgate:tipoRicezioneMessaggio" />
	</xs:sequence>
  </xs:complexType>
  <xs:element name="ricevuteEsitiAnagraficheComunali" type="sgate:tipoFileRicevuteEsitiAnagraficheComunali" />
-->
</xs:schema>